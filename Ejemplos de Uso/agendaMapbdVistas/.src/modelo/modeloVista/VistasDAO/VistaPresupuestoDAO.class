' Gambas class file
PUBLIC FUNCTION Total() AS integer 
     Dim conectar as new conexion
     Dim SQLString as string
     Dim mRs as result
     conectar.Conexion()
    SQLString  = "SELECT idpresupuesto FROM VistaPresupuesto" 
try    mRs = conectar.hconn.Exec(SQLString) 
IF ERROR THEN 
  Message.Error(" Se ha producido un ERROR al Intentar obtener lista")
  return -1 
endif 
RETURN val(Str$(mRs.Count)) 
End 

PUBLIC function BuscarIgualIdpresupuesto( valor AS string,optional CampoOrden as string ) as result
     Dim conectar as new conexion
     Dim SQLString as string
     Dim mRs as result
     conectar.Conexion()
SQLString="Select * From VistaPresupuesto"
If CampoOrden=null then 
   SQlString &= " WHERE idpresupuesto like '" & valor & "' "
else 
   SQlString &= " WHERE idpresupuesto like '" & valor & "'   Order by " & CampoOrden
endif 
Try mRs=conectar.hconn.Exec(SQLString) 
IF ERROR THEN 
Message.Error(" Se ha producido un ERROR al Buscar datos, " & "\nError: " & error.text )
else
return mRs
ENDIF
END

PUBLIC function BuscarIgualCliente( valor AS string,optional CampoOrden as string ) as result
     Dim conectar as new conexion
     Dim SQLString as string
     Dim mRs as result
     conectar.Conexion()
SQLString="Select * From VistaPresupuesto"
If CampoOrden=null then 
   SQlString &= " WHERE cliente like '" & valor & "' "
else 
   SQlString &= " WHERE cliente like '" & valor & "'   Order by " & CampoOrden
endif 
Try mRs=conectar.hconn.Exec(SQLString) 
IF ERROR THEN 
Message.Error(" Se ha producido un ERROR al Buscar datos, " & "\nError: " & error.text )
else
return mRs
ENDIF
END

PUBLIC function BuscarIgualClaveasignada( valor AS string,optional CampoOrden as string ) as result
     Dim conectar as new conexion
     Dim SQLString as string
     Dim mRs as result
     conectar.Conexion()
SQLString="Select * From VistaPresupuesto"
If CampoOrden=null then 
   SQlString &= " WHERE claveasignada like '" & valor & "' "
else 
   SQlString &= " WHERE claveasignada like '" & valor & "'   Order by " & CampoOrden
endif 
Try mRs=conectar.hconn.Exec(SQLString) 
IF ERROR THEN 
Message.Error(" Se ha producido un ERROR al Buscar datos, " & "\nError: " & error.text )
else
return mRs
ENDIF
END

PUBLIC function BuscarIgualActualizarprecios( valor AS string,optional CampoOrden as string ) as result
     Dim conectar as new conexion
     Dim SQLString as string
     Dim mRs as result
     conectar.Conexion()
SQLString="Select * From VistaPresupuesto"
If CampoOrden=null then 
   SQlString &= " WHERE actualizarprecios like '" & valor & "' "
else 
   SQlString &= " WHERE actualizarprecios like '" & valor & "'   Order by " & CampoOrden
endif 
Try mRs=conectar.hconn.Exec(SQLString) 
IF ERROR THEN 
Message.Error(" Se ha producido un ERROR al Buscar datos, " & "\nError: " & error.text )
else
return mRs
ENDIF
END

PUBLIC function BuscarIgualFecha( valor AS string,optional CampoOrden as string ) as result
     Dim conectar as new conexion
     Dim SQLString as string
     Dim mRs as result
     conectar.Conexion()
SQLString="Select * From VistaPresupuesto"
If CampoOrden=null then 
   SQlString &= " WHERE fecha like '" & valor & "' "
else 
   SQlString &= " WHERE fecha like '" & valor & "'   Order by " & CampoOrden
endif 
Try mRs=conectar.hconn.Exec(SQLString) 
IF ERROR THEN 
Message.Error(" Se ha producido un ERROR al Buscar datos, " & "\nError: " & error.text )
else
return mRs
ENDIF
END

PUBLIC function BuscarIgualDescripcioncorta( valor AS string,optional CampoOrden as string ) as result
     Dim conectar as new conexion
     Dim SQLString as string
     Dim mRs as result
     conectar.Conexion()
SQLString="Select * From VistaPresupuesto"
If CampoOrden=null then 
   SQlString &= " WHERE descripcioncorta like '" & valor & "' "
else 
   SQlString &= " WHERE descripcioncorta like '" & valor & "'   Order by " & CampoOrden
endif 
Try mRs=conectar.hconn.Exec(SQLString) 
IF ERROR THEN 
Message.Error(" Se ha producido un ERROR al Buscar datos, " & "\nError: " & error.text )
else
return mRs
ENDIF
END

PUBLIC function BuscarIgualEstado( valor AS string,optional CampoOrden as string ) as result
     Dim conectar as new conexion
     Dim SQLString as string
     Dim mRs as result
     conectar.Conexion()
SQLString="Select * From VistaPresupuesto"
If CampoOrden=null then 
   SQlString &= " WHERE estado like '" & valor & "' "
else 
   SQlString &= " WHERE estado like '" & valor & "'   Order by " & CampoOrden
endif 
Try mRs=conectar.hconn.Exec(SQLString) 
IF ERROR THEN 
Message.Error(" Se ha producido un ERROR al Buscar datos, " & "\nError: " & error.text )
else
return mRs
ENDIF
END

PUBLIC function BuscarIgualValorcalculado( valor AS string,optional CampoOrden as string ) as result
     Dim conectar as new conexion
     Dim SQLString as string
     Dim mRs as result
     conectar.Conexion()
SQLString="Select * From VistaPresupuesto"
If CampoOrden=null then 
   SQlString &= " WHERE valorcalculado like '" & valor & "' "
else 
   SQlString &= " WHERE valorcalculado like '" & valor & "'   Order by " & CampoOrden
endif 
Try mRs=conectar.hconn.Exec(SQLString) 
IF ERROR THEN 
Message.Error(" Se ha producido un ERROR al Buscar datos, " & "\nError: " & error.text )
else
return mRs
ENDIF
END

PUBLIC function BuscarIgualValorasignado( valor AS string,optional CampoOrden as string ) as result
     Dim conectar as new conexion
     Dim SQLString as string
     Dim mRs as result
     conectar.Conexion()
SQLString="Select * From VistaPresupuesto"
If CampoOrden=null then 
   SQlString &= " WHERE valorasignado like '" & valor & "' "
else 
   SQlString &= " WHERE valorasignado like '" & valor & "'   Order by " & CampoOrden
endif 
Try mRs=conectar.hconn.Exec(SQLString) 
IF ERROR THEN 
Message.Error(" Se ha producido un ERROR al Buscar datos, " & "\nError: " & error.text )
else
return mRs
ENDIF
END

PUBLIC function sql( consulta AS string) As result
     Dim conectar as new conexion
     Dim SQLString as string
     Dim mRs as result
  conectar.Conexion()
try mRs=conectar.hconn.Exec(consulta) 
If error then message.info("Consulta erronea, revisela")
return mRs
END

PUBLIC Function gridFormatearColumnas(grid AS GridView) as gridview
 Dim f As New Font
 f.name = "Sans"
 f.size = me.sizefont
   me.formatearFechaIdioma()
  me.arrayAnchoColumnas = new integer[]
   WITH grid 
      .header = 3 
      .rows.count = 0 
      .columns.count = 9 
      .Columns[0].title = ("idpresupuesto")
      .Columns[0].width = -1'f.textwidth(("idpresupuesto")&"m")
       me.arrayAnchoColumnas.add(-1)
      .Columns[1].title = ("cliente")
      .Columns[1].width = -1'f.textwidth(("cliente")&"m")
       me.arrayAnchoColumnas.add(-1)
      .Columns[2].title = ("claveasignada")
      .Columns[2].width = -1'f.textwidth(("claveasignada")&"m")
       me.arrayAnchoColumnas.add(-1)
      .Columns[3].title = ("actualizarprecios")
      .Columns[3].width = -1'f.textwidth(("actualizarprecios")&"m")
       me.arrayAnchoColumnas.add(-1)
      .Columns[4].title = ("fecha")
      .Columns[4].width = -1'f.textwidth(("fecha")&"m")
       me.arrayAnchoColumnas.add(-1)
      .Columns[5].title = ("descripcioncorta")
      .Columns[5].width = -1'f.textwidth(("descripcioncorta")&"m")
       me.arrayAnchoColumnas.add(-1)
      .Columns[6].title = ("estado")
      .Columns[6].width = -1'f.textwidth(("estado")&"m")
       me.arrayAnchoColumnas.add(-1)
      .Columns[7].title = ("valorcalculado")
      .Columns[7].width = -1'f.textwidth(("valorcalculado")&"m")
       me.arrayAnchoColumnas.add(-1)
      .Columns[8].title = ("valorasignado")
      .Columns[8].width = -1'f.textwidth(("valorasignado")&"m")
       me.arrayAnchoColumnas.add(-1)
      .font.name = "Sans"
      .font.size = 10 
      .Background = 16777215 
      .Foreground = 0 
   END WITH
 grid.Mode = Select.Single
 Return grid 
END

PUBLIC FUNCTION gridFormatearFilas(grid AS GridView) AS gridview
 dim titulolargo as string
Dim f As New Font
f.name = "Sans"
f.size = Me.sizefont
   WITH grid
      .header = 3 
      .rows.count =9
      .columns.count = 2
      .Columns[0].title = "Campos"
      .Columns[1].title = "Registro"
      .font.name = "Sans"
      .font.size = 10 
      .Background = 16777215
      .Foreground = 0 
   END WITH
      grid[0,0].text = ("idpresupuesto")
      grid[0,0].background = color.lightgray
 If Len(titulolargo) < Len(("idpresupuesto")) Then 
 titulolargo =("idpresupuesto")
endif
      grid[1,0].text = ("cliente")
      grid[1,0].background = color.lightgray
 If Len(titulolargo) < Len(("cliente")) Then 
 titulolargo =("cliente")
endif
      grid[2,0].text = ("claveasignada")
      grid[2,0].background = color.lightgray
 If Len(titulolargo) < Len(("claveasignada")) Then 
 titulolargo =("claveasignada")
endif
      grid[3,0].text = ("actualizarprecios")
      grid[3,0].background = color.lightgray
 If Len(titulolargo) < Len(("actualizarprecios")) Then 
 titulolargo =("actualizarprecios")
endif
      grid[4,0].text = ("fecha")
      grid[4,0].background = color.lightgray
 If Len(titulolargo) < Len(("fecha")) Then 
 titulolargo =("fecha")
endif
      grid[5,0].text = ("descripcioncorta")
      grid[5,0].background = color.lightgray
 If Len(titulolargo) < Len(("descripcioncorta")) Then 
 titulolargo =("descripcioncorta")
endif
      grid[6,0].text = ("estado")
      grid[6,0].background = color.lightgray
 If Len(titulolargo) < Len(("estado")) Then 
 titulolargo =("estado")
endif
      grid[7,0].text = ("valorcalculado")
      grid[7,0].background = color.lightgray
 If Len(titulolargo) < Len(("valorcalculado")) Then 
 titulolargo =("valorcalculado")
endif
      grid[8,0].text = ("valorasignado")
      grid[8,0].background = color.lightgray
 If Len(titulolargo) < Len(("valorasignado")) Then 
 titulolargo =("valorasignado")
endif
  grid.Columns[0].width=F.textwidth(titulolargo & "m") 
 Return grid
END

PUBLIC SUB contenido() as result 
     Dim conectar as new conexion
     Dim SQLString as string
     Dim mRs as result
     conectar.Conexion()
     SQLString  = "SELECT * FROM VistaPresupuesto" 
     try mRs = conectar.hconn.Exec(SQLString) 
If error then message.info("Consulta erronea, revisela")
RETURN mRs 
End 

PUBLIC FUNCTION mostrarRegistro(numero AS Integer, grid AS GridView, OPTIONAL sqlcadena AS String) AS Result
DIM resultado AS Result
IF sqlcadena = NULL THEN 
resultado = contenido()
ELSE 
resultado = sql(sqlcadena)
ENDIF 
resultado.MoveTo(numero)
TRY grid[0, 1].text = Str$(resultado!idpresupuesto)
TRY grid[1, 1].text = Str$(resultado!cliente)
TRY grid[2, 1].text = Str$(resultado!claveasignada)
TRY grid[3, 1].text = Str$(resultado!actualizarprecios)
TRY grid[4, 1].text = Str$(resultado!fecha)
TRY grid[5, 1].text = Str$(resultado!descripcioncorta)
TRY grid[6, 1].text = Str$(resultado!estado)
TRY grid[7, 1].text = Str$(resultado!valorcalculado)
TRY grid[8, 1].text = Str$(resultado!valorasignado)
END

PUBLIC FUNCTION mostrarRegistroVO(objetoVO As VistaPresupuestoVO, grid AS GridView) AS Result
TRY grid[0, 1].text = Str$(objetoVO.idpresupuesto)
TRY grid[1, 1].text = Str$(objetoVO.cliente)
TRY grid[2, 1].text = Str$(objetoVO.claveasignada)
TRY grid[3, 1].text = Str$(objetoVO.actualizarprecios)
TRY grid[4, 1].text = Str$(objetoVO.fecha)
TRY grid[5, 1].text = Str$(objetoVO.descripcioncorta)
TRY grid[6, 1].text = Str$(objetoVO.estado)
TRY grid[7, 1].text = Str$(objetoVO.valorcalculado)
TRY grid[8, 1].text = Str$(objetoVO.valorasignado)
END

PUBLIC FUNCTION GridResultanteSQL(res AS result, grid AS GridView) AS gridview  
DIM columna AS Integer
DIM hField AS ResultField
DIM a AS Integer
DIM fila AS Integer
'defino la regilla
   WITH grid 
      .header = 3 
      .rows.count = 0 
 try     .columns.count = res.Fields.Count 
      columna = -1
       FOR EACH hField IN res.Fields
      columna = columna + 1
 try     .Columns[columna].title = Str$(hField.name)
       NEXT 
       .font.name = "Sans"
      .font.size = 10
      .Background = 16777215 
      .Foreground = 0 
   END WITH
 RETURN grid 
END

public hresultadoNuevo As Result
Public gridviewPropio As GridView 'para tener acceso desde clases heredadas
Public actualiza As Observer

public iconoTrue as string= "icon:/16/apply"
public iconoFalse as string="icon:/16/cancel"
Public sizefont As Integer = 10

Public formatoFecha as string

Public Sub MostrarGridView(gridviewtrabajo As GridView, Optional cadenaSQL As String, optional resultado as result)
  
  gridFormatearColumnas(gridviewtrabajo)
  gridviewPropio = gridviewtrabajo
  
  if not isnull(resultado) then 
    hresultadoNuevo=resultado
   else
   'no ha habido resultado
    If cadenaSQL = "" Then 
      hresultadoNuevo = contenido()
    Else
      hresultadoNuevo = sql(cadenaSQL)
    Endif
  endif
   
   actualiza = New Observer(gridviewPropio) As "Observar"
  gridviewPropio.tag = Split(NombreCampos()["sintraducidos"], "|")
  gridviewPropio.rows.count = 0
  gridviewPropio.rows.count = hresultadoNuevo.count
  AsignaAnchoGrid()
End


PROPERTY ColorFilaPar AS integer 
PRIVATE hColorFilaPar AS  integer 

PRIVATE FUNCTION ColorFilaPar_read() AS integer 
  RETURN hColorFilaPar 
END  

PRIVATE SUB ColorFilaPar_write(Valor AS integer)
  hColorFilaPar = Valor 
END
PROPERTY ColorFilaImPar AS integer 
PRIVATE hColorFilaImPar AS  integer 

PRIVATE FUNCTION ColorFilaImPar_read() AS integer 
  RETURN hColorFilaImPar 
END  

PRIVATE SUB ColorFilaImPar_write(Valor AS integer)
  hColorFilaImPar = Valor 
END



Public Sub Observar_Data(row As Integer, column As Integer)
    Dim f As New Font
    dim datocontenido as variant
  
    f.name = "Sans"
    f.size = me.sizefont
  
   '-------------------------------------------
  'colores....filas impar / par ge regillas
  '-------------------------------------------
  If row Mod 2 = 0 Then
     me.gridviewPropio.Data.Background = me.ColorFilaImPar
   else
     me.gridviewPropio.Data.Background =me.ColorFilaPar
   Endif
  
  
  me.hresultadoNuevo.MoveTo(row)
  'comprobar si hay datos en TAG
  If IsNull(me.gridviewPropio.tag) Then 
 try datocontenido=me.hresultadoNuevo[replace(me.gridviewPropio.columns[column].text,"_",".")]
 if error then 
 print "warning !!: nombre de campo que no encuentro "& me.GridViewPropio.tag[column]  & " en la tabla/vista"
  endif
 
 
    if isdate(str$( datocontenido)) then
      me.gridviewPropio.Data.text = format(date(datocontenido),me.formatofecha)
    else
     if isboolean( str$(datocontenido)) then 
        if datocontenido then 
          me.gridviewPropio.data.picture=picture[me.iconoTrue]
        else
          me.gridviewPropio.data.picture=picture[me.iconoFalse]
        endif
      else
        me.gridviewPropio.Data.text = datocontenido
      endif
    endif
  ''hay datos en  TAG  
  Else
 try   datocontenido=me.hresultadoNuevo[replace(me.GridViewPropio.tag[column],"_",".")]
 if error then 
 print "warning !!: nombre de campo que no encuentro "& me.GridViewPropio.tag[column]  & " en la tabla/vista"
  endif
  
    if isdate(str$(datocontenido)) then
      me.gridviewPropio.Data.text = format(date(datocontenido),me.formatofecha)
    else
      if isboolean(str$(datocontenido)) then 
          if datocontenido then 
            me.gridviewPropio.data.picture=picture[me.iconoTrue]
          else
           me.gridviewPropio.data.picture=picture[me.iconoFalse]
          endif
        else
        me.gridviewPropio.Data.text = datocontenido
      endif
    endif
  Endif
  

  '-----------------------------------------------
  ' columna con id, con ancho 0, para que no se vea
  '-----------------------------------------------
  If Upper$(Me.gridviewPropio.Columns[column].title) = Upper$("id") Then
     me.arrayAnchoColumnas[column] = 0
     return 'salgo de la funcion
  Endif


'Compruebo ancho y amplio si es necesario.
   If me.arrayAnchoColumnas[column]< F.textwidth(me.gridviewPropio.Data.text) Then 
   me.arrayAnchoColumnas[column] = F.textwidth(me.gridviewPropio.Data.text & "m") 
  Endif
 


End

'Array que contiene los valores del ancho de las columnas.
public arrayAnchoColumnas as new integer[]

'AsignaAnchoGrid
public sub AsignaAnchoGrid()
  dim a as integer
  for a=0 to me.arrayAnchoColumnas.max
    me.gridviewPropio.Columns[a].width=me.arrayAnchoColumnas[a]
  next
end



public sub formatearFechaIdioma()
 
 If System.Language = "en_US.UTF-8" Then
      me.formatofecha = "mm/dd/yyyy" 'usa
    Else
     me.formatofecha = "dd/mm/yyyy" 'esp
    Endif
    
end

'-----------------------------------------------------
'añadido ordenar por columnas haciendo click...
'-----------------------------------------------------
PUBLIC ordenlistado AS Integer

'PUBLIC SUB Observar_ColumnClick(Column AS Integer)
'IF me.ordenlistado = 0 THEN
'me.ord_AZ(Me.gridviewPropio, Column)
'me.ordenlistado = 1
'ELSE
'me.ordenlistado = 0
'ord_ZA(Me.gridviewPropio, Column)
'ENDIF
'END

PUBLIC SUB ord_AZ(grid AS GridView, a AS Integer)
'a: indica la columna a la que ordenamos
'grid: es la rejilla que ordenamos
DIM limite AS Integer
DIM cambio1 AS String
DIM i AS Integer
DIM j AS Integer
DIM col AS Integer

limite = grid.Rows.COUNT
IF (grid.Columns.COUNT < a + 1) OR a < 0 THEN
Message.Error("Error en la columna introducida para ordenar")
grid.visible = TRUE
return

ENDIF
FOR i = 0 TO limite - 1
FOR j = 0 TO limite - 2
IF UCase$(Grid[j, a].Text) > UCase$(Grid[j + 1, a].Text) THEN


FOR col = 0 TO grid.Columns.COUNT - 1
cambio1 = Grid[j, col].Text
Grid[j, col].text = Grid[j + 1, col].Text
Grid[j + 1, col].text = cambio1
  
NEXT


ENDIF
NEXT
NEXT




END


'------------------------------------------------------------------------
PUBLIC SUB ord_ZA(grid AS GridView, a AS Integer)
'a: indica la columna a la que ordenamos
'grid: es la rejilla que ordenamos
DIM limite AS Integer
DIM cambio1 AS String
DIM i AS Integer
DIM j AS Integer
DIM col AS Integer

limite = grid.Rows.COUNT
IF (grid.Columns.COUNT < a + 1) OR a < 0 THEN
Message.Error("Error en la columna introducida para ordenar")
grid.visible = TRUE
return

ENDIF
FOR i = 0 TO limite - 2


FOR j = i TO limite - 1
IF UCase$(Grid[i, a].Text) <= UCase$(Grid[j, a].Text) THEN
FOR col = 0 TO grid.Columns.COUNT - 1
cambio1 = Grid[j, col].Text
Grid[j, col].text = Grid[i, col].Text
Grid[i, col].text = cambio1
NEXT
ENDIF
NEXT
NEXT





END



PUBLIC FUNCTION ConvertirResult(hr as result) AS VistaPresupuestoVO[]
Dim datos as new VistaPresupuestoVO[]
Dim datotmp as VistaPresupuestoVO
While hr.available
datotmp=new VistaPresupuestoVO
try datotmp.idpresupuesto=hr["idpresupuesto"]
try datotmp.cliente=hr["cliente"]
try datotmp.claveasignada=hr["claveasignada"]
try datotmp.actualizarprecios=hr["actualizarprecios"]
try datotmp.fecha=hr["fecha"]
try datotmp.descripcioncorta=hr["descripcioncorta"]
try datotmp.estado=hr["estado"]
try datotmp.valorcalculado=hr["valorcalculado"]
try datotmp.valorasignado=hr["valorasignado"]
try datos.add(datotmp)
hr.movenext
wend
return datos
end
PUBLIC FUNCTION filaSeleccionadaVO() AS VistaPresupuestoVO
Dim colecciontmp as new Collection
Dim fila as integer
Dim idbuscado as integer
Dim objTempVO as new VistaPresupuestoVO
try fila=gridviewPropio.row
if ERROR or if FILA=-1  then 
message.info(("No hay registro seleccionado"))'no hay fila seleccionada
return null
endif
 idbuscado = gridviewPropio[fila, 0].text
 objTempVO = Me.ConvertirResult(Me.BuscarIgual(idbuscado, "idpresupuesto"))[0]
Return objTempVO
end
Public Function extraeColumnaArray(datos As VistaPresupuestoVO[], nombrecampo As String) As String
Dim datotmp As Object
Dim lista As New String[]
For Each datotmp In datos
lista.Add(Object.GetProperty(datotmp, nombrecampo))
Next
Return lista.Join(",")
End
PUBLIC function BuscarIgual( valor AS integer,campoId as string, optional CampoOrden as string,optional restosql as string ) as result
     Dim conectar as new conexion
     Dim SQLString as string
     Dim mRs as result
     conectar.Conexion()
SQLString="Select * From VistaPresupuesto"
If CampoOrden=null then 
   SQlString &= " WHERE " & campoId & " like '" & valor & "' " & restosql
else 
   SQlString &= " WHERE " & campoId & " like '" & valor & "' " & restosql & " Order by " & CampoOrden
endif 
Try mRs=conectar.hconn.Exec(SQLString) 
IF ERROR THEN 
Message.Error(" Se ha producido un ERROR al Buscar datos, " & "\nError:  "   & error.text )
else 
return mRs
ENDIF 
END

Public function NombreCampos() as Collection
dim codigocampos as new Collection
dim textocamposTraducidos as string
dim textocampos as string
textocamposTraducidos=("idpresupuesto") & "|" & ("cliente") & "|" & ("claveasignada") & "|" & ("actualizarprecios") & "|" & ("fecha") & "|" & ("descripcioncorta") & "|" & ("estado") & "|" & ("valorcalculado") & "|" & ("valorasignado")
textocampos="idpresupuesto" & "|" & "cliente" & "|" & "claveasignada" & "|" & "actualizarprecios" & "|" & "fecha" & "|" & "descripcioncorta" & "|" & "estado" & "|" & "valorcalculado" & "|" & "valorasignado"
codigocampos.add(textocamposTraducidos,"traducidos")
codigocampos.add(textocampos,"sintraducidos")
RETURN codigocampos
end

Public Sub ImprimirRapidoTablaHorizontal()
    dim contenidofichero as string
  Dim codigo As String
  Dim a As Integer, fila As Integer, columna As Integer
  
  Application.busy = 1
 
  codigo = "<table border=\"1\" style=\"width:100%\">\n"
  'imprimo titulos
  codigo &= "<tr>\n" ""
  For a = 0 To gridviewPropio.columns.Max
    codigo &= "<td><b>" & gridviewPropio.Columns[a].title & "</b></td>"
  Next
  codigo &= "</tr>\n" ""
  
  For fila = 0 To gridviewPropio.Rows.Max
    
    codigo &= "<tr>\n" ""
    For columna = 0 To gridviewPropio.columns.Max
      codigo &= "<td>" & gridviewPropio[fila, columna].text & "</td>"
    Next
    codigo &= "</tr>\n" ""
    
  Next
  
  codigo &= "</table>\n"
  
  contenidofichero = File.Load("estructura.html")
  contenidofichero = Replace$(contenidofichero, "TITULO", ("INFORME"))
  contenidofichero = Replace$(contenidofichero, "CONTENIDO", codigo)
  file.Save("/tmp/informe.html", contenidofichero)
  Desktop.Open("/tmp/informe.html")
   Application.Busy = 0
End

Public Sub ImprimirRapidoTablaVertical()
  dim contenidofichero as string
  Dim codigo As String
  Dim a As Integer, fila As Integer, columna As Integer
  
  Application.busy = 1

  Try fila = gridviewPropio.Row
  If fila = -1 Or If Error Then 
    Application.Busy = 0
    Message.Info(("Seleccione un registro"))
    Return
  Endif
  
  codigo &= "<table border=\"1\" >\n"
  For columna = 0 To gridviewPropio.columns.Max
    codigo &= "<tr>\n" ""
    
    codigo &= "<td><b>" & gridviewPropio.Columns[columna].title & "</b></td>"
    
    codigo &= "<td style=\"width:100%\">" & gridviewPropio[fila, columna].text & "</td>"
    codigo &= "</tr>\n" ""
    
  Next
  codigo &= "</table>\n"  
  CODIGO &= "<BR><BR>"
  
  contenidofichero = File.Load("estructura.html")
  contenidofichero = Replace$(contenidofichero, "TITULO", ("INFORME"))
  contenidofichero = Replace$(contenidofichero, "CONTENIDO", codigo)
  file.Save("/tmp/informe.html", contenidofichero)
  Desktop.Open("/tmp/informe.html")
  Application.Busy = 0
End